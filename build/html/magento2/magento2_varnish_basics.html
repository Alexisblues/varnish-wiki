<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Basics on Magento 2 and Varnish &mdash; Varnish Documentation 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Varnish Documentation 0.0.1 documentation" href="../index.html" />
    <link rel="up" title="Varnish with Magento2" href="index.html" />
    <link rel="next" title="Varnish with Magento 1.9 and older" href="../magento1x/index.html" />
    <link rel="prev" title="Varnish with Magento2" href="index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../magento1x/index.html" title="Varnish with Magento 1.9 and older"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Varnish with Magento2"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Varnish Documentation 0.0.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" accesskey="U">Varnish with Magento2</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="basics-on-magento-2-and-varnish">
<span id="magento2-varnish-basics"></span><h1>Basics on Magento 2 and Varnish<a class="headerlink" href="#basics-on-magento-2-and-varnish" title="Permalink to this headline">¶</a></h1>
<p>This chapter is mainly written for web developers who want to get a clear idea
about the basics of varnish with magento.</p>
<p>Varnish as you may already know is designed for HTTP semantics and will soon be
available for HTTP/2.0. The new version of HTTP/2 has been released under <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc7540.txt">RFC 7540</a>.
However one must know that HTTP/2.0 is an alternative to HTTP/1.1 and doesnot
outmode HTTP/1.0.</p>
<p>What this protocol allows for any given website is to sent multiple requests in
serial mode over a single connection so that when a single client wants to fetch
several resources in paralell, it can just open several connections to fetch from
a single webserver.</p>
<p>Now imagine multiple customers trying to order several products in paralell from
a single magento webserver. The overhead this may cause is quite vast.
Which is why varnish is here to save the day!</p>
<p>To learn more about the basics of HTTP visit <a class="reference external" href="http://book.varnish-software.com/4.0/chapters/HTTP.html#resources-and-representations">HTTP Basics</a> at the <cite>Varnish Software website</cite>.</p>
<p>You also need to be clear about what you want varnish to do for your website.
To read more analyzing and understadning your website, as yourself the following questions:</p>
<ul class="simple">
<li>What makes the pages on your magento website different from each other?</li>
<li>Do differences apply to entire pages or just part of them?</li>
<li>How shall i inform varnish of the differences?</li>
</ul>
<p>TO answer all your questions, follow the link to our varnish book discussing
<a class="reference external" href="http://book.varnish-software.com/4.0/chapters/Content_Composition.html">Content Composition</a> .</p>
<p>As you will see, Varnish can help manage your magento website in more then one way.
Varnish can help your webservers with load balancing, firewalls, file compressions,
cookie management, etc.</p>
<p>A better in-site on some of these Varnish characteristics would be to get to know
our product Varnish Cache a little better. Varnish cache as the name suggests
allows caching of resources. This mechanism is enhanced to allow multiple
identical requests from different clients to have the
same effect on a single request called the idempotency.But do not worry!</p>
<p>Varnish cache if configured properly doesnot cache <cite>everything</cite>! Infact you can
decide what to cache, how to cache when to cache. To be able to better manage
the cache headers, one must understand the <cite>cache related header fields of HTTP</cite>.
Varnish uses these rfc7232 and these rfc7234 cache header fields to decide which
objects to cache.</p>
<p>If a matched cache is valid then varnish retrieves responses from the cache.
This reduces the load of the origin server further more (apart from varnishes
load balancing capacities) from managing similar responses multiple times.</p>
<div class="section" id="so-when-does-varnish-serve-the-cached-objects">
<h2>So when does Varnish serve the cached objects?<a class="headerlink" href="#so-when-does-varnish-serve-the-cached-objects" title="Permalink to this headline">¶</a></h2>
<p>In simple terms, varnish serves cache contents based on three things:</p>
<ol class="arabic simple">
<li>Cache Matching</li>
<li>Allowance</li>
<li>Freshess of Data</li>
</ol>
<div class="section" id="cache-matching">
<h3>1. Cache Matching<a class="headerlink" href="#cache-matching" title="Permalink to this headline">¶</a></h3>
<p>The cached object is properly matched. In such a case it is called <cite>cache-hit</cite>.
A proper example of a cached object on a Magento site would be common product
descriptions, but not the price! Because price may vary over time.
A cache-hit object is served without contacting the origin server. However if the
object requested is not in cache then it&#8217;s <cite>cache-miss</cite> and in this case varnish
forwards this request to the origin serer.</p>
</div>
<div class="section" id="allowance">
<h3>2. Allowance<a class="headerlink" href="#allowance" title="Permalink to this headline">¶</a></h3>
<p>As mentioned in the varnish book, Allowance is validating the <cite>cache-hit</cite>.
Varnish further has an option for a user to choose how long an object should be in
cache and when to serve from the cache and when not-to. If a cached object should
be reserved or not. This validation process is done by checking whether the
request contains the <cite>no-cache</cite> directive. In such a cache the HTTP cache-control
header is checked for the presence of <cite>no-cache</cite>.</p>
<p>Read more about the <a class="reference external" href="http://book.varnish-software.com/4.0/chapters/HTTP.html#cache-control">cache-control header</a> on the varnish book.</p>
</div>
<div class="section" id="freshness-of-data">
<h3>3.Freshness of Data<a class="headerlink" href="#freshness-of-data" title="Permalink to this headline">¶</a></h3>
<p>When deciding whether to use a cached object i.e whether to <cite>allow</cite>
it, checking the freshness of the data and evaluating whether to deliver an
expired object or not is the question.</p>
<p>There are two kinds of objects:</p>
<p><cite>fresh objects</cite> - age has not exceeded the freshness lifetime
<cite>stale objects</cite> - age has exceeded the freshness lifetime i.e. it is now an
<cite>expired object</cite>.</p>
<p>To read more about how the freshness of an object is determined visit the
varnish book, <a class="reference external" href="http://book.varnish-software.com/4.0/chapters/HTTP.html#freshness">Freshness</a> section.</p>
<p>Now let&#8217;s move on to understanding the <cite>Caching system in Magento 2 &lt;magento2_ce&gt;</cite>.</p>
<p>Remember that varnish has a lot of resources and but if you have any questions
please feel free to contact us.</p>
<div class="toctree-wrapper compound">
<ul>
<li class="toctree-l1"><a class="reference internal" href="magento2_ce.html">Caching in Magento 2</a><ul>
<li class="toctree-l2"><a class="reference internal" href="magento2_ce.html#so-why-does-magento-2-require-varnish-caching">So why does Magento 2 require varnish caching?</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="magento2_ce.html#cache-extensions">Cache Extensions</a></li>
</ul>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Basics on Magento 2 and Varnish</a><ul>
<li><a class="reference internal" href="#so-when-does-varnish-serve-the-cached-objects">So when does Varnish serve the cached objects?</a><ul>
<li><a class="reference internal" href="#cache-matching">1. Cache Matching</a></li>
<li><a class="reference internal" href="#allowance">2. Allowance</a></li>
<li><a class="reference internal" href="#freshness-of-data">3.Freshness of Data</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="index.html"
                        title="previous chapter">Varnish with Magento2</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../magento1x/index.html"
                        title="next chapter">Varnish with Magento 1.9 and older</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/magento2/magento2_varnish_basics.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../magento1x/index.html" title="Varnish with Magento 1.9 and older"
             >next</a> |</li>
        <li class="right" >
          <a href="index.html" title="Varnish with Magento2"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Varnish Documentation 0.0.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="index.html" >Varnish with Magento2</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Taiyeba.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.
    </div>
  </body>
</html>