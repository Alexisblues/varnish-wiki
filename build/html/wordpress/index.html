<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Installing VARNISH with WORDPRESS &mdash; Varnish Documentation 0.0.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="Varnish Documentation 0.0.1 documentation" href="../index.html" />
    <link rel="up" title="Getting Started" href="../start/index.html" />
    <link rel="next" title="FAQ for Beginners" href="../faq/index.html" />
    <link rel="prev" title="Installing VARNISH with Magento" href="../magento/index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../faq/index.html" title="FAQ for Beginners"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../magento/index.html" title="Installing VARNISH with Magento"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Varnish Documentation 0.0.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../start/index.html" accesskey="U">Getting Started</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="installing-varnish-with-wordpress">
<span id="wordpress"></span><h1>Installing VARNISH with WORDPRESS<a class="headerlink" href="#installing-varnish-with-wordpress" title="Permalink to this headline">¶</a></h1>
<p>Varnish is an open source reverse proxy and HTTP accelerating tool. In addition it also provides caching. It is designed for dynamic websites with heavy content and also for heavily consumed APIs. Varnish helps in speeding up a server duirng high traffic durations by standing in front of the webservers and redirecting visitors whenever possible to static pages (cache) and giving them a smoother interface for browsing. The main server is only accessed during active processes when the cache cannot provide.</p>
<p>Varnish is a very powerful HTTP accelerator used by high profile, high traffic websites for load balancing their traffic. A lot of the websites out their are using WordPress with Varnish.</p>
<p>This documentation will provide the simplest introduction to using Varnish with WordPress.This tutorial is written using a simple wordpress website as an example, but its general concepts can be used with larger applications of multiple sites and webservers.</p>
<div class="section" id="audience">
<h2>Audience:<a class="headerlink" href="#audience" title="Permalink to this headline">¶</a></h2>
<p>This reference has been prepared for web developers to get them started with Varnish installation and configuration.</p>
</div>
<div class="section" id="prerequisites">
<h2>Prerequisites:<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>It is assumed that the user has root access, has LAMP and WordPress installed on the server and is here to learn how to get varnish for their website.</p>
</div>
<div class="section" id="step-1-installing-varnish-on-ubuntu-unix">
<h2>Step 1 : Installing Varnish on Ubuntu/UNIX:<a class="headerlink" href="#step-1-installing-varnish-on-ubuntu-unix" title="Permalink to this headline">¶</a></h2>
<p>It is recommended to install the varnish package from its repository.
Start by grabbing the repository:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">curl</span> <span class="pre">http://repo.varnish-cache.org/debian/GPG-key.txt</span> <span class="pre">|</span> <span class="pre">sudo</span> <span class="pre">apt-key</span> <span class="pre">add</span> <span class="pre">-</span></code></div></blockquote>
<p>Add the repository to the source list:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/etc/apt/sources.list</span></code></div></blockquote>
<p>Add the repository by pasting the following line:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">deb</span> <span class="pre">http://repo.varnish-cache.org/ubuntu/</span> <span class="pre">trusty</span> <span class="pre">varnish-4.1</span></code></div></blockquote>
<p>Save and exit.</p>
<p>Now run update and install:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">update</span></code>
<code class="docutils literal"><span class="pre">sudo</span> <span class="pre">apt-get</span> <span class="pre">install</span> <span class="pre">varnish</span></code></div></blockquote>
</div>
<div class="section" id="step-2-configure-varnish">
<h2>Step 2: Configure VARNISH<a class="headerlink" href="#step-2-configure-varnish" title="Permalink to this headline">¶</a></h2>
<p>Varnish comes with two configuration files:
One with the starter parameter:</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">/etc/default/varnish</span></code></div></blockquote>
<p>This file contains all the starter parameters.</p>
<blockquote>
<div><code class="docutils literal"><span class="pre">/etc/varnish/default.vcl</span></code></div></blockquote>
<p>This file contains all the default policies. It also tells varnish where to find the web content.</p>
<ol class="arabic">
<li><p class="first">Start with the first one;</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">nano</span> <span class="pre">/etc/default/varnish</span></code></p>
</div></blockquote>
</li>
</ol>
<p>Here it not bound to web port 80 by default. To make it bound to port 80,
Browse down to Alternative 2 and Change port to 80.</p>
<p>Alternative 2:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">DAEMON</span> <span class="n">_OPTS</span><span class="o">=</span><span class="s2">&quot;-a :80</span><span class="se">\</span>

        <span class="o">-</span><span class="n">T</span> <span class="n">localhost</span><span class="p">:</span><span class="mi">6082</span>

        <span class="o">-</span><span class="n">f</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">varnish</span><span class="o">/</span><span class="n">default</span><span class="o">.</span><span class="n">vcl</span>

        <span class="o">-</span><span class="n">S</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">varnish</span><span class="o">/</span><span class="n">secret</span>

        <span class="o">-</span><span class="n">s</span> <span class="n">malloc</span><span class="p">,</span><span class="mi">256</span><span class="n">m</span><span class="s2">&quot;</span>
</pre></div>
</div>
<p>-T : refers to which port manages this.</p>
<p>-f : refers to the other configuration file containing all the default policies. If you plan to change the name of the default policy file, make sure to come here and change the default.vcl to the given name.</p>
<p>-S : refers to the file containing secrets such as passwords etc.</p>
<p>-s : refers to the space varnish cache is allocated. 256m” is decided based on the current servers RAM of 1GB.</p>
<p>This is all the configuration changes in this file.</p>
<ol class="arabic" start="2">
<li><p class="first">Next we will have a look at the other configuration file;</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/etc/varnish/default.vcl</span></code></p>
</div></blockquote>
</li>
</ol>
<p>This file contains configuration that points to the content. This is by default set to 8080 and points to host as localhost as shown below.</p>
<blockquote>
<div><p>Backend default {</p>
<blockquote>
<div><p>.host = “127.0.0.1”</p>
<p>.port = “8080”;</p>
</div></blockquote>
<p>}</p>
</div></blockquote>
<p>It is recommended that if changes are made to these files, it should be copied and remaned name, because when varnish updates, it will replace any changes made with it’s new default.vcl and varnish file.</p>
<p>Other changes that are recommended based on your sites needs are;</p>
<p>1.the default varnish caching time. It is by default 120 seconds. This can be changed to be a smaller or larger duration.</p>
<p>2.WordPress maybe difficult to cache with all its cookies. It is recommended to add a policy that drops cookies sent and fro WordPress.</p>
</div>
<div class="section" id="step-3-configure-apache2-to-work-with-varnish">
<h2>Step 3: Configure Apache2 to work with Varnish<a class="headerlink" href="#step-3-configure-apache2-to-work-with-varnish" title="Permalink to this headline">¶</a></h2>
<p>We have already configured varnish to point at port 8080 for server contents. However the default listening port for apache2 is port 80 which needs to be changed to 8080.</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">nano</span> <span class="pre">/etc/apache2/ports.conf</span></code></p>
<p><code class="docutils literal"><span class="pre">Listen</span> <span class="pre">8008</span> <span class="pre">#listen</span> <span class="pre">on</span> <span class="pre">port</span> <span class="pre">8080</span></code></p>
</div></blockquote>
<p>In this case the LAMP and Varnish have been cofigured on the same machine for this tutorial. However, if there is more then one webserver running, make sure to make this change on all the webservers and also change the server name.</p>
</div>
<div class="section" id="step-4-restart">
<h2>Step 4: Restart<a class="headerlink" href="#step-4-restart" title="Permalink to this headline">¶</a></h2>
<p>It is always required to restart all services one changes are made in configuration files.</p>
<blockquote>
<div><p><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">varnish</span> <span class="pre">restart</span></code></p>
<p><code class="docutils literal"><span class="pre">sudo</span> <span class="pre">service</span> <span class="pre">apache2</span> <span class="pre">restart</span></code></p>
</div></blockquote>
<div class="toctree-wrapper compound">
</div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Installing VARNISH with WORDPRESS</a><ul>
<li><a class="reference internal" href="#audience">Audience:</a></li>
<li><a class="reference internal" href="#prerequisites">Prerequisites:</a></li>
<li><a class="reference internal" href="#step-1-installing-varnish-on-ubuntu-unix">Step 1 : Installing Varnish on Ubuntu/UNIX:</a></li>
<li><a class="reference internal" href="#step-2-configure-varnish">Step 2: Configure VARNISH</a></li>
<li><a class="reference internal" href="#step-3-configure-apache2-to-work-with-varnish">Step 3: Configure Apache2 to work with Varnish</a></li>
<li><a class="reference internal" href="#step-4-restart">Step 4: Restart</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../magento/index.html"
                        title="previous chapter">Installing VARNISH with Magento</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../faq/index.html"
                        title="next chapter">FAQ for Beginners</a></p>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/wordpress/index.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../faq/index.html" title="FAQ for Beginners"
             >next</a> |</li>
        <li class="right" >
          <a href="../magento/index.html" title="Installing VARNISH with Magento"
             >previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../index.html">Varnish Documentation 0.0.1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../start/index.html" >Getting Started</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2016, Taiyeba.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.4.
    </div>
  </body>
</html>