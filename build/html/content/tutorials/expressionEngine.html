<!DOCTYPE html>


<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Expression Engine and Varnish &mdash; Varnish Wiki  documentation</title>
    
    <link rel="stylesheet" href="../../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootswatch-3.3.6/cosmo/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/bootstrap-sphinx.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="../../_static/js/jquery-fix.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-3.3.6/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="../../_static/bootstrap-sphinx.js"></script>
    <link rel="top" title="Varnish Wiki  documentation" href="../../index.html" />
    <link rel="next" title="Sitecore CMS and Varnish" href="sitecoreCMS.html" />
    <link rel="prev" title="Adobe Experience Manager and Varnish" href="aem.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">

  </head>
  <body role="document">

  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../../index.html">
          Varnish Wiki</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
                <li><a href="https://varnish-software.com">Varnish Website</a></li>
            
            
              <li class="dropdown globaltoc-container">
  <a role="button"
     id="dLabelGlobalToc"
     data-toggle="dropdown"
     data-target="#"
     href="../../index.html">Menu <b class="caret"></b></a>
  <ul class="dropdown-menu globaltoc"
      role="menu"
      aria-labelledby="dLabelGlobalToc"><ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">Varnish Web Developer&#8217;s FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="varnish/index.html">How to Varnish</a></li>
<li class="toctree-l1"><a class="reference internal" href="wordpress/index.html">WordPress with Varnish</a></li>
<li class="toctree-l1"><a class="reference internal" href="magento2/index.html">Magento2 with Varnish</a></li>
<li class="toctree-l1"><a class="reference internal" href="drupal/index.html">Drupal with Varnish</a></li>
<li class="toctree-l1"><a class="reference internal" href="aem.html">Adobe Experience Manager and Varnish</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Expression Engine and Varnish</a></li>
<li class="toctree-l1"><a class="reference internal" href="sitecoreCMS.html">Sitecore CMS and Varnish</a></li>
</ul>
</ul>
</li>
              
            
            
              
                
  <li>
    <a href="aem.html" title="Previous Chapter: Adobe Experience Manager and Varnish"><span class="glyphicon glyphicon-chevron-left visible-sm"></span><span class="hidden-sm hidden-tablet">&laquo; Adobe Experie...</span>
    </a>
  </li>
  <li>
    <a href="sitecoreCMS.html" title="Next Chapter: Sitecore CMS and Varnish"><span class="glyphicon glyphicon-chevron-right visible-sm"></span><span class="hidden-sm hidden-tablet">Sitecore CMS ... &raquo;</span>
    </a>
  </li>
              
            
            
            
            
          </ul>

          
            
<form class="navbar-form navbar-right" action="../../search.html" method="get">
 <div class="form-group">
  <input type="text" name="q" class="form-control" placeholder="Search" />
 </div>
  <input type="hidden" name="check_keywords" value="yes" />
  <input type="hidden" name="area" value="default" />
</form>
          
        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><div class="container">
    <div class="row">
      <div class="col-md-3" width="18%">
<!---        <div class="sidebar">
</div>
          <div calss="container">  --->
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <h3>Contents</h3>
    <div class="sidebar-localtoc">
      <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../start/index.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../faq/index.html">Varnish Web Developer&#8217;s FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="varnish/index.html">How to Varnish</a></li>
<li class="toctree-l1"><a class="reference internal" href="wordpress/index.html">WordPress with Varnish</a></li>
<li class="toctree-l1"><a class="reference internal" href="magento2/index.html">Magento2 with Varnish</a></li>
<li class="toctree-l1"><a class="reference internal" href="drupal/index.html">Drupal with Varnish</a></li>
<li class="toctree-l1"><a class="reference internal" href="aem.html">Adobe Experience Manager and Varnish</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Expression Engine and Varnish</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#resources">Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-sample-default-vcl-for-expression-engine">A sample default VCL for Expression Engine</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="sitecoreCMS.html">Sitecore CMS and Varnish</a></li>
</ul>

    </div>
  </div>
</div>
<!---          </div>
        </div> --->
      </div>
    </div>
</div>
<div class="sidebar-block">
  <div class="sidebar-wrapper">
    <div id="main-search">
      <form class="form-inline" action="../../search.html" method="GET" role="form">
        <div class="input-group">
          <input name="q" type="text" class="form-control" placeholder="Search...">
        </div>
        <input type="hidden" name="check_keywords" value="yes" />
        <input type="hidden" name="area" value="default" />
      </form>
    </div>
  </div>
</div>
  <div class="sidebar-block">
    <div class="sidebar-wrapper">
      <h4>&nbsp;&nbsp;Contribute</h4>
      <ul class="this-page-menu">
        <li><a href="../../_sources/content/tutorials/expressionEngine.txt"
               rel="nofollow">Show Source</a></li>
        <li><a href="https://github.com/huayra/wiki_varnish/blob/master/source/content/tutorials/expressionEngine.rst"
               rel="nofollow">Show on GitHub</a></li>
        <li><a href="https://github.com/huayra/wiki_varnish/edit/master/source/content/tutorials/expressionEngine.rst"
               rel="nofollow">Edit on GitHub</a></li>
      </ul>
    </div>
  </div>
        </div>
      </div>
    <div class="col-md-9 content">
      
  <div class="section" id="expression-engine-and-varnish">
<span id="expressionengine"></span><h1>Expression Engine and Varnish<a class="headerlink" href="#expression-engine-and-varnish" title="Permalink to this headline">¶</a></h1>
<p>Expression Engine is another powerful Digital Content Delivery Platform from the
creator of CodeIgniter (agile, open-source framework).</p>
<div class="section" id="resources">
<h2>Resources<a class="headerlink" href="#resources" title="Permalink to this headline">¶</a></h2>
<p>Overview on Varnish 4 with Expression Engine: <a class="reference external" href="https://rye.agency/blog/using-varnish-with-expressionengine">https://rye.agency/blog/using-varnish-with-expressionengine</a></p>
<p>Making Expressions Engine Sites Fly with varnish: <a class="reference external" href="https://ellislab.com/blog/entry/making-sites-fly-with-varnish">https://ellislab.com/blog/entry/making-sites-fly-with-varnish</a>
(this post is for varnish 3 configuration, other then that it&#8217;s a great explanation to move forward)</p>
<p>Controlling the cache Using ESI: <a class="reference external" href="https://www.smashingmagazine.com/2015/02/using-edge-side-includes-in-varnish/">https://www.smashingmagazine.com/2015/02/using-edge-side-includes-in-varnish/</a></p>
<p>Server Security Issues: <a class="reference external" href="https://ellislab.com/blog/entry/http-host-and-server-name-security-issues">https://ellislab.com/blog/entry/http-host-and-server-name-security-issues</a></p>
</div>
<div class="section" id="a-sample-default-vcl-for-expression-engine">
<h2>A sample default VCL for Expression Engine<a class="headerlink" href="#a-sample-default-vcl-for-expression-engine" title="Permalink to this headline">¶</a></h2>
<div class="highlight-VCL"><div class="highlight"><pre><span></span>vcl 4.0;

backend default {
  .host = &quot;127.0.0.1&quot;;  # The domain or IP address of your ExpressionEngine Site
  .port = &quot;8080&quot;;       # The port of your EE site. In production, Varnish should be on port 80, so consider changing your Apache server to port 8080
  .probe = {
    .url = &quot;/&quot;;
    .timeout = 1000ms;
    .interval = 1s;
    .window = 10;
    .threshold = 8;
    }
}

sub vcl_recv {

  # Forward client&#39;s IP to backend
  unset req.http.X-Forwarded-For;
  set req.http.X-Forwarded-For = client.ip;

  # Set the URI of your system directory
  # In this example, we assume your admin interface is in &quot;system&quot;, so just ensure it&#39;s right for your setup.
  if (req.url ~ &quot;^/system/&quot; ||
    req.url ~ &quot;ACT=&quot; ||
    req.method == &quot;POST&quot; ||
    (req.url ~ &quot;member_box&quot; &amp;&amp; req.http.Cookie ~ &quot;exp_sessionid&quot;))
    {
      return (pass);
    }

  unset req.http.Cookie;

    # This is different, read this: https://www.varnish-software.com/blog/grace-varnish-4-stale-while-revalidate-semantics-varnish
    # set req.grace = 1h;

  return(hash);
}

sub vcl_backend_response {

    # Enable ESI includes
  set beresp.do_esi = true;

    # Our cache TTL
  set beresp.ttl = 1m;

    # set beresp.grace = 1h;

  return(deliver);
}
</pre></div>
</div>
<p>source: <a class="reference external" href="https://gist.github.com/andrewfairlie/72f42dcdaacc8faaf1da">https://gist.github.com/andrewfairlie/72f42dcdaacc8faaf1da</a></p>
<p>Collected: 16th August 2016</p>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2016, Varnish Software Group.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.4.5.<br/>
    </p>
  </div>
</footer>
  </body>
</html>